---
type Props = {
  currentLocale: 'fr' | 'en';
  paths: { fr: string; en: string };
};

const { currentLocale, paths } = Astro.props as Props;
---

<div class="flex items-center gap-1">
  <button
    type="button"
    data-locale="fr"
    class={`font-title text-sm font-semibold transition-colors ${
      currentLocale === 'fr'
        ? 'text-primary cursor-default'
        : 'text-secondary hover:text-primary hover:underline cursor-pointer'
    }`}
    disabled={currentLocale === 'fr'}
  >
    FR
  </button>
  <span class="text-secondary">Â·</span>
  <button
    type="button"
    data-locale="en"
    class={`font-title text-sm font-semibold transition-colors ${
      currentLocale === 'en'
        ? 'text-primary cursor-default'
        : 'text-secondary hover:text-primary hover:underline cursor-pointer'
    }`}
    disabled={currentLocale === 'en'}
  >
    EN
  </button>
</div>

<script define:vars={{ currentLocale, paths }}>
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('button[data-locale]');

    buttons.forEach((button) => {
      if (button.hasAttribute('disabled')) return;

      button.addEventListener('click', () => {
        const targetLocale = button.getAttribute('data-locale');

        if (typeof window !== 'undefined' && window.kimeLocale) {
          // Set preferred locale
          window.kimeLocale.setPreferredLocale(targetLocale);

          // Redirect to the appropriate path
          window.kimeLocale.redirectIfNeeded({
            currentLocale,
            paths,
          });
        }
      });
    });
  });
</script>
